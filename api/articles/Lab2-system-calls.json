{"title":"Lab2: system calls","uid":"1b4d009413a4a1733c93e882f288fd9a","slug":"Lab2-system-calls","date":"2022-09-25T03:57:05.000Z","updated":"2022-09-25T07:49:21.925Z","comments":true,"path":"api/articles/Lab2-system-calls.json","keywords":null,"cover":[],"content":"<p>$\\qquad$ä¸Šå‘¨æ‰“äº†ä¸€åœºæ•°æ¨¡å›½èµ›ï¼Œæ‰“å‰å…ƒæ°”è¶…äººï¼Œæ‰“å®Œè‘›ä¼˜èººå¹³ã€‚Lab2åªæœ‰ä¸¤ä¸ªå°å®éªŒï¼Œèšç„¦äºå¦‚ä½•åˆ›å»ºç³»ç»Ÿè°ƒç”¨å‘½ä»¤ï¼Œä¹Ÿå¹¶ä¸æ˜¯é‚£ä¹ˆç®€å•ï¼Œå®éªŒæ–‡æ¡£<a href=\"https://pdos.csail.mit.edu/6.828/2021/labs/syscall.html\">æˆ³è¿™</a>ã€‚</p>\n<img src=\"/images/æ“ä½œç³»ç»Ÿ/2.png\" title alt data-align=\"center\">\n\n<span id=\"more\"></span>\n\n<br>\n\n<h2><span id=\"coding\">â– Coding</span></h2><hr>\n<h4><span id=\"ï¸-system-call-tracing-moderate\">â˜‘ï¸ System call tracingÂ (moderate)</span></h4><p>$\\qquad$æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªtraceç³»ç»Ÿè°ƒç”¨æ¥è¿½è¸ªä¸€ä¸ªå‘½ä»¤ä¸­æŒ‡å®šçš„ç³»ç»Ÿè°ƒç”¨ï¼Œå¹¶æ‰“å°å‡ºç›¸åº”çš„è¿”å›å€¼ã€‚</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ trace 2147483647 grep hello README</span><br><span class=\"line\">4: syscall trace -&gt; 0</span><br><span class=\"line\">4: syscall exec -&gt; 3</span><br><span class=\"line\">4: syscall open -&gt; 3</span><br><span class=\"line\">4: syscall read -&gt; 1023</span><br><span class=\"line\">4: syscall read -&gt; 966</span><br><span class=\"line\">4: syscall read -&gt; 70</span><br><span class=\"line\">4: syscall read -&gt; 0</span><br><span class=\"line\">4: syscall close -&gt; 0</span><br></pre></td></tr></table></figure>\n\n<p>$\\qquad$æŒ‡ä»¤æ ¼å¼ï¼š<code>trace mask cmd</code>ã€‚maskç”¨æ¥æŒ‡å®šéœ€è¦è¿½è¸ªçš„ç³»ç»Ÿè°ƒç”¨ï¼Œåœ¨æ“ä½œç³»ç»Ÿä¸­æ¯ä¸ªç³»ç»Ÿè°ƒç”¨éƒ½ä¼šæœ‰è‡ªå·±å”¯ä¸€çš„ç¼–å·SYS_syscallï¼ˆåœ¨kernel&#x2F;syscall.hä¸­çš„å®å®šä¹‰ï¼‰ï¼Œæ¯”å¦‚è¯´forkçš„ç¼–å·å°±æ˜¯SYS_forkï¼Œå¦‚æœ<code>mask&amp;(1&lt;&lt;SYS_syscall)!=0</code>å°±è¯´æ˜éœ€è¦è¿½è¸ªè¯¥syscallï¼Œéœ€è¦æ‰“å°å‡ºå…¶è¿”å›å€¼ï¼Œæœ¬è´¨ä¸Šå¦‚æœå‡è®¾$mask[i]$ä»£è¡¨å…¶äºŒè¿›åˆ¶ä½$i$ä½æ•°å­—çš„è¯ï¼Œé‚£ä¹ˆ$mask[i]&#x3D;1$å°±ä»£è¡¨éœ€è¦è¿½è¸ªSYS_syscall&#x3D;$i$çš„ç³»ç»Ÿè°ƒç”¨ã€‚</p>\n<p>$\\qquad$é‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦åœ¨è¿›ç¨‹ç»“æ„ä½“procä¸­åŠ å…¥<code>int mask</code>ï¼Œæ³¨æ„åˆ°ä¸€ä¸ªè¿›ç¨‹ä¸­æ‰§è¡Œä¸åŒç³»ç»Ÿè°ƒç”¨æ˜¯é€šè¿‡forkæ¥å®ç°çš„ï¼Œæœ¬è´¨ä¸Šåˆåˆ›å»ºäº†ä¸€ä¸ªprocå®ä½“ï¼Œå› æ­¤åœ¨forkçš„å®ç°ï¼ˆkernel&#x2F;proc.cï¼‰ä¸­æˆ‘ä»¬éœ€è¦å®ç°maskçš„ä¼ é€’ï¼š</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Â Â Â Â np-&gt;mask = p-&gt;mask;</span><br></pre></td></tr></table></figure>\n\n<p>$\\qquad$é‚£ä¹ˆæ¥ä¸‹æ¥å°±å¯ä»¥æ‰“å°ä¿¡æ¯<code>pid: syscall name -&gt; return_value</code>ã€‚æˆ‘ä»¬å¯ä»¥åœ¨æ¯ä¸ªç³»ç»Ÿè°ƒç”¨éƒ½å¿…ç»çš„å‡½æ•°syscallï¼ˆkernel&#x2F;syscall.cï¼‰é‡Œé¢å®ç°ï¼Œé¦–å…ˆè§‚å¯Ÿsyscallå‡½æ•°ï¼š</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">syscall</span><span class=\"params\">(<span class=\"type\">void</span>)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"type\">int</span> num;</span><br><span class=\"line\">  <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">proc</span> *<span class=\"title\">p</span> =</span> myproc();</span><br><span class=\"line\"></span><br><span class=\"line\">  num = p-&gt;trapframe-&gt;a7;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (num &gt; <span class=\"number\">0</span> &amp;&amp; num &lt; NELEM(syscalls) &amp;&amp; syscalls[num])</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    p-&gt;trapframe-&gt;a0 = syscalls[num]();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">else</span></span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%d %s: unknown sys call %d\\n&quot;</span>,p-&gt;pid, p-&gt;name, num);</span><br><span class=\"line\">    p-&gt;trapframe-&gt;a0 = <span class=\"number\">-1</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>$\\qquad$å¯ä»¥çœ‹å‡ºpé‡Œé¢å­˜å‚¨äº†æˆ‘ä»¬éœ€è¦çš„pidï¼Œä½†p-&gt;nameå¹¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç³»ç»Ÿè°ƒç”¨åç§°ï¼Œæ³¨æ„åˆ°forkå®ç°ä¸­ï¼ˆkernel&#x2F;proc.cï¼š304ï¼‰æ˜¯ç›´æ¥æ‹·è´åŸprocçš„nameï¼Œå³nameé‡Œå­˜å‚¨çš„å…¶å®æ˜¯è¿›ç¨‹åï¼š</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">safestrcpy(np-&gt;name, p-&gt;name, <span class=\"keyword\">sizeof</span>(p-&gt;name)ï¼‰;</span><br></pre></td></tr></table></figure>\n\n<p>$\\qquad$è¿™é‡Œéœ€è¦æ³¨æ„è¿›ç¨‹ä¸çº¿ç¨‹ä¹‹é—´çš„å·®åˆ«ã€‚è™½ç„¶forkå®Œåä¹Ÿæ˜¯ä¸€ä¸ªprocç»“æ„ä½“ï¼Œä½†äº‹å®ä¸Šåªæ˜¯p-&gt;nameè¿›ç¨‹ä¸‹çš„ä¸€ä¸ªçº¿ç¨‹è€Œå·²ã€‚è¿›ç¨‹æ˜¯å¯¹è¿è¡Œç¨‹åºçš„å°è£…ï¼Œæ˜¯ç³»ç»Ÿè¿›è¡Œ<strong>èµ„æºè°ƒåº¦å’Œåˆ†é…</strong>çš„åŸºæœ¬å•ä½ï¼Œå„è¿›ç¨‹ä¹‹é—´ç›¸äº’éš”ç¦»ä¸å…±äº«æ•°æ®ï¼Œå®ç°äº†æ“ä½œç³»ç»Ÿçš„å¹¶å‘æ€§ï¼›è€Œçº¿ç¨‹åˆ™æ˜¯ä¸€ä¸ªè¿›ç¨‹ä¸­çš„å­ä»»åŠ¡ï¼Œæ˜¯<strong>CPUè°ƒåº¦</strong>çš„æœ€å°å•ä½ï¼Œä¸€ä¸ªè¿›ç¨‹ä¸­çš„æ‰€æœ‰çº¿ç¨‹å…±äº«è¯¥è¿›ç¨‹çš„æ•°æ®èµ„æºã€‚é‚£ä¹ˆæ¯ä¸ªå‘½ä»¤å°±æ˜¯ä¸€ä¸ªè¿›ç¨‹ï¼Œé‡Œé¢ä¼šæ‰§è¡Œå¤šä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œæ¯ä¸ªç³»ç»Ÿè°ƒç”¨éƒ½æ˜¯ä¸€ä¸ªçº¿ç¨‹ã€‚</p>\n<p>$\\qquad$è™½ç„¶pé‡Œé¢æ²¡æœ‰çº¿ç¨‹åç§°çš„ç›´æ¥ä¿¡æ¯ï¼Œä½†è‚¯å®šæœ‰å…¶ä»–ç›¸å…³ä¿¡æ¯ã€‚æ³¨æ„åˆ°</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">p-&gt;trapframe-&gt;a0 = syscalls[num]();</span><br></pre></td></tr></table></figure>\n\n<p>è¿™é‡Œè°ƒç”¨äº†<code>syscalls[num]</code>ï¼Œç„¶åå°†è¿”å›å€¼ä¼ é€’ç»™äº†a0å¯„å­˜å™¨ï¼ˆRISC-Vçš„Cè§„èŒƒæ˜¯æŠŠè¿”å›å€¼æ”¾åœ¨a0ä¸­ï¼‰ã€‚syscallsæ˜¯ä¸€ä¸ªæ— ç¬¦å·æ•´å‹æŒ‡é’ˆæ•°ç»„ï¼Œå³å‡½æ•°æŒ‡é’ˆã€‚é‚£ä¹ˆå¯ä»¥è‚¯å®šè¿™ä¸ªnumå°†æ˜¯ä¸€ä¸ªé‡è¦çš„çªç ´å£ï¼Œæˆ‘ä»¬åªè¦æŒ‰ç…§syscallsä¸­ç³»ç»Ÿè°ƒç”¨çš„é¡ºåºå®šä¹‰ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„sysnameï¼Œ<code>sysname[num]</code>å°±æ˜¯ç³»ç»Ÿè°ƒç”¨çš„åç§°äº†ã€‚åŒæ—¶<code>p-&gt;trapframe-&gt;a0</code>å°±æ˜¯å‡½æ•°è¿”å›å€¼ã€‚</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">107</span> + â”‚ <span class=\"keyword\">extern</span> uint64 <span class=\"title function_\">sys_trace</span><span class=\"params\">(<span class=\"type\">void</span>)</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">132</span> + â”‚ [SYS_trace]   sys_trace, <span class=\"comment\">//static uint64 (*syscalls[])(void)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">136</span> + â”‚ <span class=\"type\">char</span> *sysname[] = &#123;</span><br><span class=\"line\"><span class=\"number\">137</span> + â”‚ [SYS_fork]    <span class=\"string\">&quot;fork&quot;</span>,</span><br><span class=\"line\"><span class=\"number\">138</span> + â”‚ [SYS_exit]    <span class=\"string\">&quot;exit&quot;</span>,</span><br><span class=\"line\"><span class=\"number\">139</span> + â”‚ [SYS_wait]    <span class=\"string\">&quot;wait&quot;</span>,</span><br><span class=\"line\"><span class=\"number\">140</span> + â”‚ [SYS_pipe]    <span class=\"string\">&quot;pipe&quot;</span>,</span><br><span class=\"line\"><span class=\"number\">141</span> + â”‚ [SYS_read]    <span class=\"string\">&quot;read&quot;</span>,</span><br><span class=\"line\"><span class=\"number\">142</span> + â”‚ [SYS_kill]    <span class=\"string\">&quot;kill&quot;</span>,</span><br><span class=\"line\"><span class=\"number\">143</span> + â”‚ [SYS_exec]    <span class=\"string\">&quot;exec&quot;</span>,</span><br><span class=\"line\"><span class=\"number\">144</span> + â”‚ [SYS_fstat]   <span class=\"string\">&quot;stat&quot;</span>,</span><br><span class=\"line\"><span class=\"number\">145</span> + â”‚ [SYS_chdir]   <span class=\"string\">&quot;chdir&quot;</span>,</span><br><span class=\"line\"><span class=\"number\">146</span> + â”‚ [SYS_dup]     <span class=\"string\">&quot;dup&quot;</span>,</span><br><span class=\"line\"><span class=\"number\">147</span> + â”‚ [SYS_getpid]  <span class=\"string\">&quot;getpid&quot;</span>,</span><br><span class=\"line\"><span class=\"number\">148</span> + â”‚ [SYS_sbrk]    <span class=\"string\">&quot;sbrk&quot;</span>,</span><br><span class=\"line\"><span class=\"number\">149</span> + â”‚ [SYS_sleep]   <span class=\"string\">&quot;sleep&quot;</span>,</span><br><span class=\"line\"><span class=\"number\">150</span> + â”‚ [SYS_uptime]  <span class=\"string\">&quot;uptime&quot;</span>,</span><br><span class=\"line\"><span class=\"number\">151</span> + â”‚ [SYS_open]    <span class=\"string\">&quot;open&quot;</span>,</span><br><span class=\"line\"><span class=\"number\">152</span> + â”‚ [SYS_write]   <span class=\"string\">&quot;write&quot;</span>,</span><br><span class=\"line\"><span class=\"number\">153</span> + â”‚ [SYS_mknod]   <span class=\"string\">&quot;mknod&quot;</span>,</span><br><span class=\"line\"><span class=\"number\">154</span> + â”‚ [SYS_unlink]  <span class=\"string\">&quot;unlink&quot;</span>,</span><br><span class=\"line\"><span class=\"number\">155</span> + â”‚ [SYS_link]    <span class=\"string\">&quot;link&quot;</span>,</span><br><span class=\"line\"><span class=\"number\">156</span> + â”‚ [SYS_mkdir]   <span class=\"string\">&quot;mkdir&quot;</span>,</span><br><span class=\"line\"><span class=\"number\">157</span> + â”‚ [SYS_close]   <span class=\"string\">&quot;close&quot;</span>,</span><br><span class=\"line\"><span class=\"number\">158</span> + â”‚ [SYS_trace]   <span class=\"string\">&quot;trace&quot;</span>,</span><br><span class=\"line\"><span class=\"number\">159</span>   â”‚ &#125;;</span><br><span class=\"line\"><span class=\"number\">160</span>   â”‚ </span><br><span class=\"line\"><span class=\"number\">161</span>   â”‚ <span class=\"type\">void</span></span><br><span class=\"line\"><span class=\"number\">162</span>   â”‚ syscall(<span class=\"type\">void</span>)</span><br><span class=\"line\"><span class=\"number\">163</span>   â”‚ &#123;</span><br><span class=\"line\"><span class=\"number\">164</span>   â”‚   <span class=\"type\">int</span> num;</span><br><span class=\"line\"><span class=\"number\">165</span>   â”‚   <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">proc</span> *<span class=\"title\">p</span> =</span> myproc();</span><br><span class=\"line\"><span class=\"number\">166</span>   â”‚ </span><br><span class=\"line\"><span class=\"number\">167</span>   â”‚   num = p-&gt;trapframe-&gt;a7;</span><br><span class=\"line\"><span class=\"number\">168</span>   â”‚   <span class=\"keyword\">if</span>(num &gt; <span class=\"number\">0</span> &amp;&amp; num &lt; NELEM(syscalls) &amp;&amp; syscalls[num]) &#123;</span><br><span class=\"line\"><span class=\"number\">169</span>   â”‚     p-&gt;trapframe-&gt;a0 = syscalls[num]();</span><br><span class=\"line\"><span class=\"number\">170</span> + â”‚     <span class=\"keyword\">if</span>(<span class=\"number\">1</span>&lt;&lt;num &amp; p-&gt;mask)</span><br><span class=\"line\"><span class=\"number\">171</span> + â”‚         <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%d: syscall %s -&gt; %d\\n&quot;</span>,p-&gt;pid,sysname[num],p-&gt;trapframe-&gt;a0);</span><br><span class=\"line\"><span class=\"number\">172</span>   â”‚   &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\"><span class=\"number\">173</span>   â”‚     <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%d %s: unknown sys call %d\\n&quot;</span>,</span><br><span class=\"line\"><span class=\"number\">174</span>   â”‚             p-&gt;pid, p-&gt;name, num);</span><br><span class=\"line\"><span class=\"number\">175</span>   â”‚     p-&gt;trapframe-&gt;a0 = <span class=\"number\">-1</span>;</span><br><span class=\"line\"><span class=\"number\">176</span>   â”‚   &#125;</span><br><span class=\"line\"><span class=\"number\">177</span>   â”‚ &#125;</span><br></pre></td></tr></table></figure>\n\n<p>$\\qquad$oå¯¹ï¼Œæˆ‘ä»¬ç”šè‡³è¿˜æ²¡å®ç°traceå‡½æ•°ğŸ’¦ã€‚ä½ å¯èƒ½ä¼šè§‰å¾—ä¸Šé¢çš„åšæ³•å·²ç»é—´æ¥å®ç°äº†traceï¼Œä½†äº‹å®ä¸Štraceæ˜¯åœ¨ç”¨æˆ·æ¨¡å¼ï¼ˆuser modeï¼‰è°ƒç”¨çš„ï¼Œå› æ­¤ä¼ å…¥çš„å‚æ•°è¿˜åœ¨ç”¨æˆ·ç©ºé—´ï¼Œè€Œç³»ç»Ÿè°ƒç”¨éƒ½æ˜¯åœ¨å†…æ ¸ç©ºé—´å†…æ‰§è¡Œçš„ï¼Œä¸ºäº†æ“ä½œç³»ç»Ÿä¸å—è¿›ç¨‹å½±å“ä¸¤è€…æ˜¯åˆ†éš”çš„ã€‚</p>\n<img title src=\"/images/æ“ä½œç³»ç»Ÿ/3.png\" alt data-align=\"center\" width=\"420\">\n\n<p>$\\qquad$ç”¨æˆ·æ€çš„traceå‡½æ•°å·²ç»å¸®æˆ‘ä»¬å®ç°ï¼š</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&quot;kernel/param.h&quot;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&quot;kernel/types.h&quot;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&quot;kernel/stat.h&quot;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&quot;user/user.h&quot;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">main</span><span class=\"params\">(<span class=\"type\">int</span> argc, <span class=\"type\">char</span> *argv[])</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">  <span class=\"type\">int</span> i;</span><br><span class=\"line\">  <span class=\"type\">char</span> *nargv[MAXARG];</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(argc &lt; <span class=\"number\">3</span> || (argv[<span class=\"number\">1</span>][<span class=\"number\">0</span>] &lt; <span class=\"string\">&#x27;0&#x27;</span> || argv[<span class=\"number\">1</span>][<span class=\"number\">0</span>] &gt; <span class=\"string\">&#x27;9&#x27;</span>))&#123;</span><br><span class=\"line\">    <span class=\"built_in\">fprintf</span>(<span class=\"number\">2</span>, <span class=\"string\">&quot;Usage: %s mask command\\n&quot;</span>, argv[<span class=\"number\">0</span>]);</span><br><span class=\"line\">    <span class=\"built_in\">exit</span>(<span class=\"number\">1</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"built_in\">trace</span>(<span class=\"built_in\">atoi</span>(argv[<span class=\"number\">1</span>])) &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">fprintf</span>(<span class=\"number\">2</span>, <span class=\"string\">&quot;%s: trace failed\\n&quot;</span>, argv[<span class=\"number\">0</span>]);</span><br><span class=\"line\">    <span class=\"built_in\">exit</span>(<span class=\"number\">1</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">for</span>(i = <span class=\"number\">2</span>; i &lt; argc &amp;&amp; i &lt; MAXARG; i++)&#123;</span><br><span class=\"line\">    nargv[i<span class=\"number\">-2</span>] = argv[i];</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"built_in\">exec</span>(nargv[<span class=\"number\">0</span>], nargv);</span><br><span class=\"line\">  <span class=\"built_in\">exit</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>$\\qquad$ä¸éš¾çœ‹å‡ºå…³é”®å‡½æ•°æ˜¯<code>int trace(int)</code>ï¼Œé‚£æˆ‘ä»¬éœ€è¦å…ˆåœ¨user&#x2F;user.hä¸­å£°æ˜è¯¥ç³»ç»Ÿè°ƒç”¨ï¼ŒåŒæ—¶åœ¨user&#x2F;usys.plï¼ˆç”Ÿæˆæ±‡ç¼–æ–‡ä»¶user&#x2F;usys.Sï¼‰ä¸­åŠ å…¥<code>entry(&quot;trace&quot;)</code>ä½¿traceå‡½æ•°å¯ä»¥è¿›å…¥å†…æ ¸æ¨¡å¼ï¼Œå¹¶åœ¨<code>kernel/syscall.h</code>ä¸­æ·»åŠ ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨å·ï¼Œæ•´ä¸ªç³»ç»Ÿè°ƒç”¨è¿‡ç¨‹å¦‚ä¸‹æ‰€ç¤º$^{[2]}$ï¼š</p>\n<ol>\n<li><p>user&#x2F;user.hï¼šç”¨æˆ·æ€ç¨‹åºè°ƒç”¨è·³æ¿å‡½æ•° trace()</p>\n</li>\n<li><p>user&#x2F;usys.Sï¼šè·³æ¿å‡½æ•° trace ä½¿ç”¨ CPU æä¾›çš„ ecall æŒ‡ä»¤ï¼Œè¿›å…¥å†…æ ¸æ¨¡å¼</p>\n</li>\n<li><p>kernel&#x2F;syscall.cï¼šåˆ°è¾¾å†…æ ¸æ¨¡å¼ç»Ÿä¸€æ‰§è¡Œç³»ç»Ÿè°ƒç”¨å¤„ç†å‡½æ•°syscallï¼Œæ‰€æœ‰ç³»ç»Ÿè°ƒç”¨éƒ½ä¼šè·³åˆ°è¿™é‡Œæ¥å¤„ç†</p>\n</li>\n<li><p>kernel&#x2F;syscall.cï¼šsyscallæ ¹æ®è·³æ¿ä¼ è¿›æ¥çš„ç³»ç»Ÿè°ƒç”¨ç¼–å·ï¼ŒæŸ¥è¯¢ syscalls[] è¡¨ï¼Œæ‰¾åˆ°å¯¹åº”çš„å†…æ ¸å‡½æ•°å¹¶è°ƒç”¨</p>\n</li>\n<li><p>kernel&#x2F;sysproc.cï¼šåˆ°è¾¾ sys_trace å‡½æ•°ï¼Œæ‰§è¡Œå…·ä½“å†…æ ¸æ“ä½œ</p>\n</li>\n</ol>\n<p>$\\qquad$æ¥ä¸‹æ¥åªéœ€åœ¨kernel&#x2F;sysproc.cä¸­å®ç°sys_traceï¼Œè¯¥å‡½æ•°åªè¦æŠŠç”¨æˆ·ç©ºé—´çš„maskæ‹¿è¿›æ¥å°±è¡Œï¼Œcmdåœ¨æ‰§è¡Œæ—¶äº‹å®ä¸Šå¯ä»¥è®¤ä¸ºæ˜¯traceçš„å¤šä¸ªå­çº¿ç¨‹ï¼Œå› æ­¤maskä¼šä¸€ç›´ä¼ é€’ä¸‹å»ã€‚</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">uint64</span><br><span class=\"line\"><span class=\"title function_\">sys_trace</span><span class=\"params\">(<span class=\"type\">void</span>)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">   <span class=\"type\">int</span> mask;</span><br><span class=\"line\">   <span class=\"keyword\">if</span>(argint(<span class=\"number\">0</span>, &amp;mask) &lt; <span class=\"number\">0</span>)</span><br><span class=\"line\">       <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">   myproc()-&gt;mask=mask;</span><br><span class=\"line\">   <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<br>\n\n<h4><span id=\"ï¸-sysinfo-moderate\">â˜‘ï¸ Sysinfo (moderate)</span></h4><p>$\\qquad$å®ç°ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨sysinfoï¼Œå®ƒæ¥å—ä¸€ä¸ªæŒ‡å‘struct sysinfoçš„æŒ‡é’ˆï¼Œç„¶åå‘è¿™ä¸ªç»“æ„ä½“å†™å…¥å‰©ä½™ç©ºé—´çš„å­—èŠ‚æ•°å’ŒçŠ¶æ€éâ€UNUSEDâ€çš„è¿›ç¨‹æ•°ã€‚</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><br><span class=\"line\">       â”‚ File: kernel/sysinfo.h</span><br><span class=\"line\">â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><br><span class=\"line\">   <span class=\"number\">1</span>   â”‚ <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">sysinfo</span> &#123;</span></span><br><span class=\"line\">   <span class=\"number\">2</span>   â”‚   uint64 freemem;   <span class=\"comment\">// amount of free memory (bytes)</span></span><br><span class=\"line\">   <span class=\"number\">3</span>   â”‚   uint64 nproc;     <span class=\"comment\">// number of process</span></span><br><span class=\"line\">   <span class=\"number\">4</span>   â”‚ &#125;;</span><br><span class=\"line\">â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><br></pre></td></tr></table></figure>\n\n<p>$\\qquad$é¦–å…ˆæˆ‘ä»¬éœ€è¦å®ç°ç»Ÿè®¡å‰©ä½™ç©ºé—´å­—èŠ‚æ•°å’Œå·²ä½¿ç”¨è¿›ç¨‹æ•°çš„å‡½æ•°ã€‚å…³äºç©ºé—´åˆ†é…çš„å®ç°åœ¨kernel&#x2F;kalloc.cï¼Œæ³¨æ„åˆ°kmemä¸­æœ‰ä¸€é¡¹freelisté“¾è¡¨ï¼Œç„¶åçœ‹kfreeå‡½æ•°</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">46</span>   â”‚ <span class=\"type\">void</span></span><br><span class=\"line\"><span class=\"number\">47</span>   â”‚ kfree(<span class=\"type\">void</span> *pa)</span><br><span class=\"line\"><span class=\"number\">48</span>   â”‚ &#123;</span><br><span class=\"line\"><span class=\"number\">49</span>   â”‚   <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">run</span> *<span class=\"title\">r</span>;</span></span><br><span class=\"line\"><span class=\"number\">50</span>   â”‚ </span><br><span class=\"line\"><span class=\"number\">51</span>   â”‚   <span class=\"keyword\">if</span>(((uint64)pa % PGSIZE) != <span class=\"number\">0</span> || (<span class=\"type\">char</span>*)pa &lt; end || (uint64)pa &gt;= PHYSTOP)</span><br><span class=\"line\"><span class=\"number\">52</span>   â”‚     panic(<span class=\"string\">&quot;kfree&quot;</span>);</span><br><span class=\"line\"><span class=\"number\">53</span>   â”‚ </span><br><span class=\"line\"><span class=\"number\">54</span>   â”‚   <span class=\"comment\">// Fill with junk to catch dangling refs.</span></span><br><span class=\"line\"><span class=\"number\">55</span>   â”‚   <span class=\"built_in\">memset</span>(pa, <span class=\"number\">1</span>, PGSIZE);</span><br><span class=\"line\"><span class=\"number\">56</span>   â”‚ </span><br><span class=\"line\"><span class=\"number\">57</span>   â”‚   r = (<span class=\"keyword\">struct</span> run*)pa;</span><br><span class=\"line\"><span class=\"number\">58</span>   â”‚ </span><br><span class=\"line\"><span class=\"number\">59</span>   â”‚   acquire(&amp;kmem.lock);</span><br><span class=\"line\"><span class=\"number\">60</span>   â”‚   r-&gt;next = kmem.freelist;</span><br><span class=\"line\"><span class=\"number\">61</span>   â”‚   kmem.freelist = r;</span><br><span class=\"line\"><span class=\"number\">62</span>   â”‚   release(&amp;kmem.lock);</span><br><span class=\"line\"><span class=\"number\">63</span>   â”‚ &#125;</span><br></pre></td></tr></table></figure>\n\n<p>kfreeå‡½æ•°å°†paåœ°å€å¼€å§‹PGSIZEå¤§å°çš„ç©ºé—´éƒ½åˆå§‹åŒ–ä¸º1ï¼Œç„¶åå°†paæŒ‚åˆ°freelistçš„å¤´ä¸Šï¼Œå†å°†freelistæŒ‡å‘paï¼Œè€Œkallocå‡½æ•°åˆ™æ˜¯æ¯æ¬¡éƒ½ä½¿ç”¨freelistçš„ç¬¬ä¸€å—PGSIZEç©ºé—´ã€‚è¯´æ˜freelistæ˜¯å¯ç”¨ç©ºé—´çš„é“¾è¡¨ï¼Œè€Œä¸”æ¯æ¬¡åˆ†é…çš„æœ€å°å•å…ƒæ˜¯PGSIZEå­—èŠ‚ï¼Œé‚£ä¹ˆæˆ‘ä»¬åªè¦æ•°ä¸€ä¸‹freelistçš„å…ƒç´ ä¸ªæ•°ç„¶åä¹˜ä¸ªPGSIZEå³å¯ã€‚</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">uint64</span><br><span class=\"line\"><span class=\"title function_\">count_freemem</span><span class=\"params\">(<span class=\"type\">void</span>)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  acquire(&amp;kmem.lock);</span><br><span class=\"line\">  <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">run</span> *<span class=\"title\">r</span> =</span> kmem.freelist;</span><br><span class=\"line\">  uint64 cnt = <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"keyword\">while</span> (r)</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    ++cnt;</span><br><span class=\"line\">    r = r-&gt;next;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  release(&amp;kmem.lock);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> cnt * PGSIZE;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>$\\qquad$ä¸ºé˜²æ­¢ç«æ€æ¡ä»¶äº§ç”Ÿï¼Œåœ¨ç»Ÿè®¡æ—¶éœ€è¦å…ˆç»™kmemä¸Šé”ã€‚</p>\n<br>\n\n<p>$\\qquad$å¯¹äºç»Ÿè®¡çŠ¶æ€ä¸ºéâ€UNUSEDâ€çš„è¿›ç¨‹æ•°ä¹Ÿä¸éš¾ï¼Œæ³¨æ„åˆ°kernel&#x2F;proc.cä¸­</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">11</span>   â”‚ <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">proc</span> <span class=\"title\">proc</span>[<span class=\"title\">NPROC</span>];</span></span><br></pre></td></tr></table></figure>\n\n<p>$\\qquad$å¯çŸ¥æœ€å¤§è¿›ç¨‹æ•°å³ä¸ºNPROCï¼Œé‚£ä¹ˆæˆ‘ä»¬åªè¦éå†procï¼Œç„¶åä¾æ¬¡æ£€æŸ¥çŠ¶æ€å³å¯ã€‚</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">uint64</span><br><span class=\"line\"><span class=\"title function_\">count_process</span><span class=\"params\">(<span class=\"type\">void</span>)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  uint64 cnt = <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; NPROC; ++i)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (proc[i].state != UNUSED)</span><br><span class=\"line\">      ++cnt;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> cnt;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>$\\qquad$æœ€åæˆ‘ä»¬åªè¦å°†è¿™ä¸ªsysinfoç»“æ„ä½“æ‹·è´è‡³ç”¨æˆ·ç©ºé—´å³å¯ã€‚é¦–å…ˆé€šè¿‡argaddrå‡½æ•°è·å–ç”¨æˆ·æ€<code>int sysinfo(struct sysinfo *)</code>ä¼ å…¥çš„sysinfoè™šåœ°å€ï¼Œç„¶åç»“åˆè¯¥è¿›ç¨‹çš„é¡µè¡¨pagetableå¯ä»¥å¾—åˆ°è¯¥åœ°å€å¯¹åº”çš„ç‰©ç†åœ°å€ï¼Œæœ€åå°†å†…æ ¸ä¸­çš„sysinfoç»“æ„ä½“æ‹·è´è¿‡å»ã€‚</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">uint64</span><br><span class=\"line\"><span class=\"title function_\">sys_sysinfo</span><span class=\"params\">(<span class=\"type\">void</span>)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">proc</span> *<span class=\"title\">p</span> =</span> myproc();</span><br><span class=\"line\">  <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">sysinfo</span> <span class=\"title\">sf</span>;</span></span><br><span class=\"line\">  uint64 addr;</span><br><span class=\"line\">  sf.freemem = count_freemem();</span><br><span class=\"line\">  sf.nproc = count_process();</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (argaddr(<span class=\"number\">0</span>, &amp;addr) &lt; <span class=\"number\">0</span> || copyout(p-&gt;pagetable, addr, (<span class=\"type\">char</span> *)&amp;sf, <span class=\"keyword\">sizeof</span>(sf)) &lt; <span class=\"number\">0</span>)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>$\\qquad$argaddrç¬¬ä¸€ä¸ªå‚æ•°0æ˜¯æŒ‡ä»a0å¯„å­˜å™¨è·å–ï¼Œæˆ‘ç‰¹åœ°å›å»ç¿»äº†ä¸€ä¸‹è®¡ç»„PPT</p>\n<img title src=\"/images/æ“ä½œç³»ç»Ÿ/4.png\" alt data-align=\"center\" width=\"650\">\n\n<p>$\\qquad$æœç„¶ï¼Œa0ã€a1å­˜å‚¨å‡½æ•°å‚æ•°ï¼Œas I guessã€‚</p>\n<p>$\\qquad$å…¶ä½™å£°æ˜ä¹‹ç±»çš„ä¸ä¸Šé¢çš„traceç±»ä¼¼ã€‚å¦å¤–åˆ«å¿˜äº†åœ¨kernel&#x2F;sysproc.cä¸­åŠ å…¥</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">9</span> + â”‚ <span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&quot;kernel/sysinfo.h&quot;</span></span></span><br></pre></td></tr></table></figure>\n\n<p>$\\qquad$å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œåœ¨xv6å¯åŠ¨åè¾“å…¥sysinfotestä¼šè¾“å‡ºOKã€‚</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sysinfotest</span><br><span class=\"line\">sysinfotest: start</span><br><span class=\"line\">sysinfotest: OK</span><br></pre></td></tr></table></figure>\n\n<br>\n\n<h2><span id=\"reference\">â– Reference</span></h2><hr>\n<p>$\\qquad$<strong>[1]</strong>$\\quad$<a href=\"https://zhuanlan.zhihu.com/p/332243456\">MIT 6.S081 2020 Lab2 system callsè®²è§£</a></p>\n<p>$\\qquad$<strong>[2]</strong>$\\quad$<a href=\"https://blog.miigon.net/posts/s081-lab2-system-calls/\">[mit6.s081] ç¬”è®° Lab2: System calls | ç³»ç»Ÿè°ƒç”¨</a></p>\n","text":"$\\qquad$ä¸Šå‘¨æ‰“äº†ä¸€åœºæ•°æ¨¡å›½èµ›ï¼Œæ‰“å‰å…ƒæ°”è¶…äººï¼Œæ‰“å®Œè‘›ä¼˜èººå¹³ã€‚Lab2åªæœ‰ä¸¤ä¸ªå°å®éªŒï¼Œèšç„¦äºå¦‚ä½•åˆ›å»ºç³»ç»Ÿè°ƒç”¨å‘½ä»¤ï¼Œä¹Ÿå¹¶ä¸æ˜¯é‚£ä¹ˆç®€å•ï¼Œå®éªŒæ–‡æ¡£æˆ³è¿™ã€‚ â– Coding â˜‘ï¸ System call tracing (moderate)$\\qquad$æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªtraceç³»ç»Ÿ...","link":"","photos":[],"count_time":{"symbolsCount":"8.1k","symbolsTime":"7 mins."},"categories":[{"name":"æ“ä½œç³»ç»Ÿ","slug":"æ“ä½œç³»ç»Ÿ","count":3,"path":"api/categories/æ“ä½œç³»ç»Ÿ.json"}],"tags":[{"name":"èµ°ç è§‚èŠ±","slug":"èµ°ç è§‚èŠ±","count":15,"path":"api/tags/èµ°ç è§‚èŠ±.json"},{"name":"xv6","slug":"xv6","count":3,"path":"api/tags/xv6.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\"><span class=\"toc-text\">â– Coding</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\"><span class=\"toc-text\">â˜‘ï¸ System call tracingÂ (moderate)</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\"><span class=\"toc-text\">â˜‘ï¸ Sysinfo (moderate)</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\"><span class=\"toc-text\">â– Reference</span></a></li></ol>","author":{"name":"Starlit Rover","slug":"blog-author","avatar":"https://encrypted-tbn3.gstatic.com/images?q=tbn:ANd9GcQWu4nWh5NV26rlAS5lR23iaundn5IVlV3EpYGNAdtnMObooQnk","link":"/","description":"Stroll in the starlit firmament~","socials":{"github":"https://github.com/StarlitRover","twitter":"https://twitter.com/Starlit_Rover","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"steam":{"icon":"/images/aurora/steam.svg","link":"https://steamcommunity.com/id/starlitrover/"}}}},"mapped":true,"prev_post":{"title":"ã€Œ1067ã€Sort with Swap(0, i)","uid":"f66bf5b8d2fc86417cb09b027c83ec14","slug":"ã€Œ1067ã€Sort-with-Swap-0-i","date":"2022-09-25T09:25:33.000Z","updated":"2022-09-25T10:12:35.709Z","comments":true,"path":"api/articles/ã€Œ1067ã€Sort-with-Swap-0-i.json","keywords":null,"cover":null,"text":"Given any permutation of the numbers {0, 1, 2,â€¦, Nâˆ’1}, it is easy to sort them in increasing order. But what if Swap(0, *) is the ONLY opera...","link":"","photos":[],"count_time":{"symbolsCount":"2.2k","symbolsTime":"2 mins."},"categories":[{"name":"PATï¼ˆAdvanced Levelï¼‰Practice","slug":"PATï¼ˆAdvanced-Levelï¼‰Practice","count":153,"path":"api/categories/PATï¼ˆAdvanced-Levelï¼‰Practice.json"}],"tags":[{"name":"Cï¼‹ï¼‹","slug":"Cï¼‹ï¼‹","count":160,"path":"api/tags/Cï¼‹ï¼‹.json"},{"name":"Graph","slug":"Graph","count":16,"path":"api/tags/Graph.json"}],"author":{"name":"Starlit Rover","slug":"blog-author","avatar":"https://encrypted-tbn3.gstatic.com/images?q=tbn:ANd9GcQWu4nWh5NV26rlAS5lR23iaundn5IVlV3EpYGNAdtnMObooQnk","link":"/","description":"Stroll in the starlit firmament~","socials":{"github":"https://github.com/StarlitRover","twitter":"https://twitter.com/Starlit_Rover","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"steam":{"icon":"/images/aurora/steam.svg","link":"https://steamcommunity.com/id/starlitrover/"}}}}},"next_post":{"title":"ã€Œ1066ã€Root of AVL Tree","uid":"42640cc884e7d3b61d24e0f58f7990cd","slug":"ã€Œ1066ã€Root-of-AVL-Tree","date":"2022-09-24T16:14:37.000Z","updated":"2022-10-19T10:54:11.913Z","comments":true,"path":"api/articles/ã€Œ1066ã€Root-of-AVL-Tree.json","keywords":null,"cover":[],"text":"An AVL tree is a self-balancing binary search tree. In an AVL tree, the heights of the two child subtrees of any node differ by at most one;...","link":"","photos":[],"count_time":{"symbolsCount":"4.4k","symbolsTime":"4 mins."},"categories":[{"name":"PATï¼ˆAdvanced Levelï¼‰Practice","slug":"PATï¼ˆAdvanced-Levelï¼‰Practice","count":153,"path":"api/categories/PATï¼ˆAdvanced-Levelï¼‰Practice.json"}],"tags":[{"name":"Cï¼‹ï¼‹","slug":"Cï¼‹ï¼‹","count":160,"path":"api/tags/Cï¼‹ï¼‹.json"},{"name":"Tree","slug":"Tree","count":23,"path":"api/tags/Tree.json"},{"name":"AVL","slug":"AVL","count":2,"path":"api/tags/AVL.json"}],"author":{"name":"Starlit Rover","slug":"blog-author","avatar":"https://encrypted-tbn3.gstatic.com/images?q=tbn:ANd9GcQWu4nWh5NV26rlAS5lR23iaundn5IVlV3EpYGNAdtnMObooQnk","link":"/","description":"Stroll in the starlit firmament~","socials":{"github":"https://github.com/StarlitRover","twitter":"https://twitter.com/Starlit_Rover","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"steam":{"icon":"/images/aurora/steam.svg","link":"https://steamcommunity.com/id/starlitrover/"}}}}}}